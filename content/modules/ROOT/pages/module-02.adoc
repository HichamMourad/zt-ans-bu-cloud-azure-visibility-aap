 -- üëã Introduction ===
+
==== Estimated time to complete: _5 minutes_<p>
+
Welcome to the second challenge.
For this challenge we will learn how to retrieve public cloud information with a job template.

Login to Automation controller with the following credentials

[cols=2*]
|===
| username:
| `admin`

| password:
| `ansible123!`
|===

= ‚òëÔ∏è Task 1 - Create a Job Template

To create a *Job Template* we need three main components:

. An *inventory* to run the automation against
. A *credential* to access the API
. A *project* to sync playbooks from.

Click the *Templates* link in the left navigation menu underneath the Resources tab.

image::https://github.com/IPvSean/pictures_for_github/blob/master/job_templates.png?raw=true[,150]

* Now click on `Add` then scroll down and click  `Add job template`

image:https://github.com/IPvSean/pictures_for_github/blob/master/add_job_template.png?raw=true[,200] + Fill out the following fields:

'''+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Name+++</td>++++++<td>+++Retrieve region info+++</td>+++
+++<tr>++++++<td>+++Job Type+++</td>++++++<td>+++Run+++</td>+++
+++<tr>++++++<td>+++Inventory+++</td>++++++<td>+++Azure Inventory+++</td>+++
+++<tr>++++++<td>+++Project+++</td>++++++<td>+++Cloud Visibility Project+++</td>+++
+++<tr>++++++<td>+++Execution Environment+++</td>++++++<td>+++Microsoft Azure Execution Environment+++</td>+++
+++<tr>++++++<td>+++Playbook+++</td>++++++<td>++++++<code>+++playbooks/retrieve_regions.yml+++</code>++++++</td>+++
+++<tr>++++++<td>+++Credentials+++</td>++++++<td>++++++<code>+++azure_credential+++</code>++++++</td>+++
</table>
+++<hr>++++++</hr>+++

* If you have trouble finding the `azure_credential` make sure you are looking under the Credential Type `Microsoft Azure Resource Manager`

Click the blue **Save** button.


The project we are loading Ansible Playbooks from can be found here +++<a target="_new" href="https://github.com/ansible-cloud/azure_visibility">+++on GitHub+++</a>+++


‚òëÔ∏è Task 2 - Launch the Job Template
===

Click the **Templates** link in the left navigation menu underneath the Resources tab.  You will see your `Retrieve Region Info` job template.

Click the rocket symbol to `Launch Template`.
+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/launch_job.png?raw=true" style="width:80px;margin-left:0px">++++++</img>+++

This playbook has two tasks. The first task `azure.azcollection.azure_rm_resource_info` will retrieve structured data for locations.  The 2nd task will use the `ansible.builtin.debug` module to print this out to the terminal which we can see in the automation controller job window.

Click on the `print var all_regions` task output then click on the `JSON` tab.  You will see the structured data retrieve for all available regions on the Microsoft Azure account.  We have pre-configured one (1) region `useast` with a virtual network and two virtual machines.

![json_data.png](../assets/json_data.png)

This structured data can be used in our future challenge to create dynamic documentation.


‚òëÔ∏è Task 3 - Create more job templates
===

There is two more job templates similar to the `Retrieve Region Info`  we can create.  One for virtual networks and one for virtual machines.

Create the following two job templates:

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/add_job_template.png?raw=true" style="width:200px;margin-left:0px">++++++</img>++++++<br>++++++</br>+++
Fill out the following fields:
+++<hr>++++++</hr>+++
+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Name+++</td>++++++<td>+++Retrieve virtual networks info+++</td>+++
+++<tr>++++++<td>+++Job Type+++</td>++++++<td>+++Run+++</td>+++
+++<tr>++++++<td>+++Inventory+++</td>++++++<td>+++Azure Inventory+++</td>+++
+++<tr>++++++<td>+++Project+++</td>++++++<td>+++Cloud Visibility Project+++</td>+++
+++<tr>++++++<td>+++Execution Environment+++</td>++++++<td>+++Microsoft Azure Execution Environment+++</td>+++
+++<tr>++++++<td>+++Playbook+++</td>++++++<td>++++++<code>+++playbooks/retrieve_networks.yml+++</code>++++++</td>+++
+++<tr>++++++<td>+++Credentials+++</td>++++++<td>++++++<code>+++azure_credential+++</code>++++++</td>+++
</table>
+++<hr>++++++</hr>+++

+++<hr>++++++</hr>+++

+++<table>++++++<tr>++++++<td>+++Name+++</td>++++++<td>++++++<b>+++Retrieve virtual machines info+++</b>++++++</td>+++
+++<tr>++++++<td>+++Job Type+++</td>++++++<td>+++Run+++</td>+++
+++<tr>++++++<td>+++Inventory+++</td>++++++<td>+++Azure Inventory+++</td>+++
+++<tr>++++++<td>+++Project+++</td>++++++<td>+++Cloud Visibility Project+++</td>+++
+++<tr>++++++<td>+++Execution Environment+++</td>++++++<td>+++Microsoft Azure Execution Environment+++</td>+++
+++<tr>++++++<td>+++Playbook+++</td>++++++<td>++++++<code>+++playbooks/retrieve_vms.yml+++</code>++++++</td>+++
+++<tr>++++++<td>+++Credentials+++</td>++++++<td>++++++<code>+++azure_credential+++</code>++++++</td>+++
</table>

Run these two job templates and examine the output.  You will see that under the `Retrieve Virtual Machines Info` Job Template that you will retrieve two virtual machines, `RHEL-ansible` and `WIN-ansible`.

‚òëÔ∏è Task 4 - Create a Survey
===

Click the **Templates** link in the left navigation menu underneath the Resources tab.  You will see your `Retrieve Virtual Machines Info` job template.

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/job_templates.png?raw=true" style="width:200px;margin-left:0px">++++++</img>+++

* Click the `Retrieve Virtual Machines Info` link to open the job template.
* Now, click the `Survey` tab at the top of the job template.

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/survey_tab.png?raw=true" style="width:400px;margin-left:0px">++++++</img>+++

* Click the blue `Add` button.

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/survey_add.png?raw=true" style="width:100px;margin-left:0px">++++++</img>+++

Fill out the following values:
+++<hr>++++++</hr>+++

+++<table>++++++<tr>++++++<th>+++Parameter+++</th>++++++<th>+++Value+++</th>++++++</tr>+++
+++<tr>++++++<td>+++Question+++</td>++++++<td>+++What tag do you want to filter on?+++</td>++++++<tr>++++++<tr>++++++<td>+++Answer variable name+++</td>++++++<td>++++++<code>+++your_tags+++</code>++++++</td>++++++<tr>++++++<tr>++++++<td>+++Answer type+++</td>++++++<td>+++text+++</td>++++++<tr>++++++<tr>++++++<td>+++Required+++</td>++++++<td>+++‚òëÔ∏è+++</td>++++++<tr>++++++<tr>++++++<td>+++Default answer+++</td>++++++<td>++++++<code>+++demo:true+++</code>++++++</td>++++++</tr>+++
</table>

Click the blue **Save** button.

+++<hr>++++++</hr>+++

Make sure to click the toggle button to enabled the survey.

+++<img src="https://github.com/IPvSean/pictures_for_github/blob/master/survey_enabled.png?raw=true" style="width:200px;margin-left:0px">++++++</img>+++

Either click the `Details` tab or click the **Templates** link in the left navigation menu underneath the Resources tab.  You will see your `Retrieve Virtual Machines Info` job template again.  Launch the job again.

+++<hr>++++++</hr>+++

This time you will see a survey prompt!

Surveys set extra variables for the playbook in a user-friendly question and answer way.  This allows you to abstract complexity using question and answer format.

Try using `os:windows` to only retrieve the Windows virtual machine or `os:linux` to retrieve the Red Hat Enterprise Linux machine.  This may seem super simple for two virtual machines, but when there are hundreds of virtual machines running, it is necessary to filter by tags to help manage, and automate different machines.


‚úÖ Next Challenge
===
Press the `Check` button below to go to the next challenge once you've completed the task.

üêõ Encountered an issue?
====

If you have encountered an issue or have noticed something not quite right, please [open an issue](https://github.com/ansible/instruqt/issues/new?title=Issue+with+Ansible+Hybrid+Cloud+Automation+-+Infrastructure+visibility&assignees=ipvsean).+++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</tr>++++++</table>+++
